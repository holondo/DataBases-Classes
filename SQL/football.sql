CREATE DOMAIN UF AS VARCHAR(2)
CHECK (VALUE IN ('RJ','SP','ES','MG','PR','SC','RS','MS','GO','AC','AL','AP','AM','BA','CE','DF','MA','MT','PA','PB','PE','PI','RN','RO','RR','SE','TO'));

CREATE TABLE EQUIPE
(
	IDequipe INTEGER,
	nome varchar(100),
	estado UF,
	tipo varchar(15),
	saldo_gols INTEGER,
	
	CONSTRAINT pk_equipe PRIMARY KEY(IDequipe),
	CONSTRAINT un_equipe UNIQUE(nome)
);

CREATE TABLE JOGA
(
	IDequipe1 INTEGER,
	IDequipe2 INTEGER,
	classico BOOLEAN DEFAULT FALSE,
	
	CONSTRAINT pk_joga PRIMARY KEY(IDequipe1, IDequipe2),
	CONSTRAINT fk_joga_e1 FOREIGN KEY(IDequipe1) REFERENCES EQUIPE(IDequipe),
	CONSTRAINT fk_joga_e2 FOREIGN KEY(IDequipe2) REFERENCES EQUIPE(IDequipe)
);

CREATE TABLE PARTIDA
(
	IDequipe1 INTEGER,
	IDequipe2 INTEGER,
	data DATE,
	gols_equipe1 INTEGER,
	gols_equipe2 INTEGER,
	local VARCHAR(100),
	
	CONSTRAINT pk_partida PRIMARY KEY(IDequipe1, IDequipe2, data),
	CONSTRAINT fk_partida FOREIGN KEY(IDequipe1, IDequipe2) REFERENCES JOGA(IDequipe1, IDequipe2)
);

CREATE TABLE JOGADOR
(
	RG VARCHAR(9),
	NOME VARCHAR(100),
	DATA_NASCIMENTO DATE,
	NATURALIDADE VARCHAR(100),
	IDEQUIPE INTEGER,
	
	CONSTRAINT pk_jogador PRIMARY KEY(RG),
	CONSTRAINT un_jogador UNIQUE(NOME),
	CONSTRAINT fk_jogador FOREIGN KEY(IDEQUIPE) REFERENCES EQUIPE(IDEQUIPE)
);

CREATE TABLE POSICAO_JOGADOR
(
	JOGADOR VARCHAR(9),
	POSICAO VARCHAR(100),
	
	CONSTRAINT pk_posicao PRIMARY KEY(JOGADOR, POSICAO),
	CONSTRAINT fk_posicao FOREIGN KEY(JOGADOR) REFERENCES JOGADOR(RG)
);

CREATE TABLE DIRETOR
(
	EQUIPE INTEGER,
	NOME VARCHAR(50),
	SOBRENOME VARCHAR(50),
	
	CONSTRAINT pk_diretor PRIMARY KEY(EQUIPE, NOME, SOBRENOME),
	CONSTRAINT fk_diretor FOREIGN KEY(EQUIPE) REFERENCES EQUIPE(IDEQUIPE)
);

CREATE TABLE UNIFORME
(
	EQUIPE INTEGER,
	TIPO VARCHAR(100),
	COR_PRINCIPAL VARCHAR(50),
	
	CONSTRAINT pk_uniforme PRIMARY KEY(EQUIPE,TIPO),
	CONSTRAINT fk_uniforme FOREIGN KEY(EQUIPE) REFERENCES EQUIPE(IDEQUIPE)
);

INSERT INTO EQUIPE VALUES(0, 'YANOMAMIS', 'AM', 'BOM', 0);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'MBYA', 'SP', 'profissional', 3);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'paraná', 'PR', 'profissional', 3);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Guaraní', 'PR', 'amador', 3);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Charrua', 'RS', 'profissional', 21);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Kambiwá', 'PE', 'amador', 100);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Parmera', 'SP', 'amador', 5);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Guajajara', 'MA', 'profissional', 25);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Grêmio Prudente', 'SP', 'amador', 50);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Goitacás', 'GO', 'amador', 3);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Audax', 'SP', 'amador', 8);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Tupiniquim', 'RJ', 'profissional', 5);
INSERT INTO EQUIPE VALUES((SELECT MAX(IDEQUIPE) FROM EQUIPE)+1, 'Tupinambá', 'BA', 'amador', 3);

INSERT INTO JOGA VALUES((SELECT IDEQUIPE FROM EQUIPE WHERE NOME = 'YANOMAMIS'), (SELECT IDEQUIPE FROM EQUIPE WHERE NOME = 'MBYA'), DEFAULT);
INSERT INTO JOGA VALUES (11, 12, true);
INSERT INTO JOGA(IDEQUIPE1, IDEQUIPE2) VALUES (12, 3);
INSERT INTO JOGA VALUES(2, 1, TRUE);
INSERT INTO JOGA VALUES(2, 3, TRUE);
INSERT INTO JOGA VALUES(10, 8, TRUE);
INSERT INTO JOGA VALUES(7, 5, false);
INSERT INTO JOGA VALUES(8, 7, DEFAULT);
INSERT INTO JOGA VALUES(8, 9, DEFAULT);
INSERT INTO JOGA VALUES(6, 4, DEFAULT);

INSERT INTO JOGADOR VALUES('123456789', 'JORGE', NULL, 'BRASILEIRO', 6);
INSERT INTO JOGADOR VALUES('987654321', 'Kwarahy', to_timestamp('05/02/1999', 'DD/MM/YYYY'), 'Brasileiro', 7);
INSERT INTO JOGADOR VALUES('135707531', 'Jasy', to_timestamp('05/02/1999', 'DD/MM/YYYY'), 'Brasileiro', 3);
INSERT INTO JOGADOR VALUES('125634780', 'A', to_timestamp('30/08/1814', 'DD/MM/YYYY'), 'Brasileiro', 6);
INSERT INTO JOGADOR VALUES('097865341', 'B', to_timestamp('30/07/1998', 'DD/MM/YYYY'), 'Brasileiro', 12);
INSERT INTO JOGADOR VALUES('125634783', 'Kim Moon', to_timestamp('20/05/2001', 'DD/MM/YYYY'), 'Norte Coreano', 10);
INSERT INTO JOGADOR VALUES('125636780', 'Mami', to_timestamp('18/02/0004', 'DD/MM/YYYY'), 'Brasileiro', 0);
INSERT INTO JOGADOR VALUES('625637780', 'Jon', to_timestamp('30/08/1980', 'DD/MM/YYYY'), 'Ingles', 4);
INSERT INTO JOGADOR VALUES('125664780', 'Gabriel Goal', to_timestamp('30/08/1994', 'DD/MM/YYYY'), 'Holandes', 2);
INSERT INTO JOGADOR VALUES('125622780', 'Josef', to_timestamp('30/03/2000', 'DD/MM/YYYY'), 'Brasileiro', 6);

INSERT INTO POSICAO_JOGADOR VALUES('123456789', 'Atacante');
INSERT INTO POSICAO_JOGADOR VALUES('987654321', 'Atacante');
INSERT INTO POSICAO_JOGADOR VALUES('135707531', 'Centro Avante');
INSERT INTO POSICAO_JOGADOR VALUES('125634780', 'Atacante');
INSERT INTO POSICAO_JOGADOR VALUES('097865341', 'Atacante');
INSERT INTO POSICAO_JOGADOR VALUES('125634783', 'Goleiro');
INSERT INTO POSICAO_JOGADOR VALUES('125636780', 'Atacante');
INSERT INTO POSICAO_JOGADOR VALUES('625637780', 'Zagueiro');
INSERT INTO POSICAO_JOGADOR VALUES('125664780', 'Atacante');
INSERT INTO POSICAO_JOGADOR VALUES('125622780', 'Atacante');

INSERT INTO DIRETOR VALUES(0,'A','A');
INSERT INTO DIRETOR VALUES(1,'B','B');
INSERT INTO DIRETOR VALUES(2,'C','C');
INSERT INTO DIRETOR VALUES(3,'D','D');
INSERT INTO DIRETOR VALUES(4,'E','E');
INSERT INTO DIRETOR VALUES(5,'F','F');
INSERT INTO DIRETOR VALUES(6,'G','G');
INSERT INTO DIRETOR VALUES(7,'H','H');
INSERT INTO DIRETOR VALUES(8,'I','I');
INSERT INTO DIRETOR VALUES(9,'J','J');

INSERT INTO UNIFORME VALUES(1, 'NORMAL1');
INSERT INTO UNIFORME VALUES(2, 'NORMAL2');
INSERT INTO UNIFORME VALUES(3, 'NORMAL1');
INSERT INTO UNIFORME VALUES(4, 'ESPECIAL');
INSERT INTO UNIFORME VALUES(5, 'NORMAL2');
INSERT INTO UNIFORME VALUES(6, 'NORMAL1');
INSERT INTO UNIFORME VALUES(7, 'NORMAL2');
INSERT INTO UNIFORME VALUES(8, 'NORMAL1');
INSERT INTO UNIFORME VALUES(9, 'ESPECIAL');

INSERT INTO PARTIDA VALUES(7, 5, TO_TIMESTAMP('11/03/2019', 'DD/MM/YYYY'),0, 3, 'ITAQUERA');
INSERT INTO PARTIDA VALUES(8, 7, TO_TIMESTAMP('11/03/2019', 'DD/MM/YYYY'), 1, 7, 'ARENA BARUERI');
INSERT INTO PARTIDA VALUES(8, 9, TO_TIMESTAMP('11/03/2019', 'DD/MM/YYYY'), 4,1, 'MARACANÃ');
INSERT INTO PARTIDA VALUES(6, 4, TO_TIMESTAMP('11/03/2019', 'DD/MM/YYYY'), 1, 7, 'ARENA BARUERI');
INSERT INTO PARTIDA VALUES(2, 1, TO_TIMESTAMP('21/05/2017', 'DD/MM/YYYY'), 4,1, 'MARACANÃ');
INSERT INTO PARTIDA VALUES(2, 3, TO_TIMESTAMP('21/05/2017', 'DD/MM/YYYY'),0, 3, 'ALLIANZ PARK');
INSERT INTO PARTIDA VALUES(7, 5, TO_TIMESTAMP('15/07/2021', 'DD/MM/YYYY'), 1, 7, 'ARENA BARUERI');
INSERT INTO PARTIDA VALUES(8, 7, TO_TIMESTAMP('15/07/2021', 'DD/MM/YYYY'), 4,1, 'MARACANÃ');
INSERT INTO PARTIDA VALUES(8, 9, TO_TIMESTAMP('15/07/2021', 'DD/MM/YYYY'),0, 3, 'ALLIANZ PARK');
INSERT INTO PARTIDA VALUES(6, 4, TO_TIMESTAMP('15/07/2021', 'DD/MM/YYYY'), 5, 5, 'GINÁSIO JOSÉ CORREA');

--1
SELECT * FROM EQUIPE left join jogador on equipe.idequipe = jogador.idequipe;

--2
select * from uniforme inner join equipe on equipe.IDequipe = uniforme.equipe
	where uniforme.tipo = 'titular' 
	and equipe.tipo = 'profissional'
	and equipe.estado = 'MG' 

--3
select jg.nome, jg.naturalidade, eq.nome, eq.estado, pos.posicao
	from jogador jg 
	inner join equipe eq on eq.idequipe = jg.idequipe
	inner join posicao_jogador pos on jg.rg = pos.jogador
	
--4
select estado, avg(saldo_gols) as saldo_gols from equipe 
	group by estado
	order by estado
	
--5
select tipo, estado, sum(saldo_gols) as saldo_gols from equipe 
	group by estado, tipo
	order by tipo, estado
	
--6
select tipo, estado, sum(saldo_gols) as saldo_gols_avg from equipe
	where tipo = 'profissional'
	group by estado, tipo
		having sum(saldo_gols) between 3 and 10
	order by tipo, estado
	
--7
select tipo, estado, sum(saldo_gols) as saldo_gols from equipe
	where tipo = 'profissional' and saldo_gols <> 0
	group by estado, tipo
	order by tipo, estado
	
--8
select rg, nome, naturalidade from jogador 
	where extract(YEAR from data_nascimento) = 1980

--9
select rg, nome, naturalidadefrom jogador 
	where (current_date - data_nascimento)/365.25 > 30
	
--10
	

select * from equipe
select * from jogador
select * from posicao_jogador
select * from partida